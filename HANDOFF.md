# SMART CONTROL HUB - Project Handoff

**–î–∞—Ç–∞:** 2026-02-02
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–°–ï –§–ê–ó–´ –ó–ê–í–ï–†–®–ï–ù–´
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** Production-ready BI-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| **–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤** | 95+ |
| **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞** | ~22,000+ |
| **API Endpoints** | 50+ |
| **SQLAlchemy –º–æ–¥–µ–ª–µ–π** | 10 |
| **Pydantic —Å—Ö–µ–º** | 60+ |
| **Vue –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤** | 15+ |
| **Celery –∑–∞–¥–∞—á** | 9 |
| **Unit —Ç–µ—Å—Ç–æ–≤** | 100+ |

### Git –∏—Å—Ç–æ—Ä–∏—è
```
f76f074 fix: SQLAlchemy Enum to use lowercase values for PostgreSQL
6a3c854 fix: Python 3.9 compatibility and missing dependencies
442f14d docs: Complete project handoff documentation
551836e feat: Phase 6 - Telegram Bot Integration
b5c2255 feat: Phase 5 - Forecasting (Revenue, Demand, Anomaly Detection)
533bb62 docs: Complete project handoff with Phase 4 details
325ef7d feat: Phase 4 - Advanced Analytics (Motive, P&L, HR, Basket)
5ddb403 docs: Add detailed development history to HANDOFF.md
fd075be feat: Phase 2 & 3 - Reports API and Vue.js Dashboard
e1e462a feat: Phase 1 - Foundation for SMART CONTROL HUB BI platform
```

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        –ö–õ–ò–ï–ù–¢–´                                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Web Dashboard ‚îÇ  Telegram Bot    ‚îÇ  Telegram Mini App            ‚îÇ
‚îÇ  (Vue.js 3)    ‚îÇ  (python-telegram-bot)                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                  ‚îÇ                      ‚îÇ
       ‚ñº                  ‚ñº                      ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    FastAPI Backend                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ /api/v1/                                                 ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ auth          (JWT + Telegram OAuth)               ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ organizations (multi-tenant)                       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ venues        (CRUD + sync)                        ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ reports       (sales, menu, export)                ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ analytics     (motive, pnl, hr, basket)            ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ forecasting   (revenue, demand, anomalies)         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ telegram      (webhook, notifications)             ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                     ‚îÇ                        ‚îÇ
       ‚ñº                     ‚ñº                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PostgreSQL  ‚îÇ    ‚îÇ    Redis     ‚îÇ    ‚îÇ   Celery Workers        ‚îÇ
‚îÇ  (–¥–∞–Ω–Ω—ã–µ)    ‚îÇ    ‚îÇ   (–∫–µ—à)      ‚îÇ    ‚îÇ  ‚îú‚îÄ‚îÄ sync tasks         ‚îÇ
‚îÇ              ‚îÇ    ‚îÇ              ‚îÇ    ‚îÇ  ‚îú‚îÄ‚îÄ aggregation        ‚îÇ
‚îÇ              ‚îÇ    ‚îÇ              ‚îÇ    ‚îÇ  ‚îî‚îÄ‚îÄ telegram notify    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                   ‚îÇ
                                                   ‚ñº
                                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                        ‚îÇ   External APIs         ‚îÇ
                                        ‚îÇ  ‚îú‚îÄ‚îÄ iiko Cloud API     ‚îÇ
                                        ‚îÇ  ‚îî‚îÄ‚îÄ Telegram Bot API   ‚îÇ
                                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 1. –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

**SMART CONTROL HUB** ‚Äî BI-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–Ω–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞, –∞–Ω–∞–ª–æ–≥ MOZG REST.

### –¶–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å POS-—Å–∏—Å—Ç–µ–º–∞–º–∏ (iiko, R-Keeper)
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂ –∏ –º–µ–Ω—é
- –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã—Ä—É—á–∫–∏ –∏ —Å–ø—Ä–æ—Å–∞
- –î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ Telegram Bot + Mini App + Web Dashboard

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è |
|-----------|------------|--------|
| Backend API | FastAPI | 0.109.0 |
| Database | PostgreSQL | 15 |
| Cache | Redis | 7 |
| Task Queue | Celery | 5.3.6 |
| ORM | SQLAlchemy | 2.0.25 (async) |
| Auth | JWT + Telegram OAuth | python-jose |

---

## 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
mozg-analytics/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deps.py              # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, RBAC
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ v1/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ auth.py          # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è endpoints
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ organizations.py # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–µ–π
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ venues.py        # CRUD –∑–∞–≤–µ–¥–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ reports.py       # –û—Ç—á—ë—Ç—ã endpoints
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ analytics.py     # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ endpoints
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ schemas.py       # Pydantic —Å—Ö–µ–º—ã
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ router.py        # –†–æ—É—Ç–µ—Ä API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py            # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ security.py          # JWT, –ø–∞—Ä–æ–ª–∏, Telegram auth
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ celery_app.py        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Celery
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py              # –ë–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã –º–æ–¥–µ–ª–µ–π
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py            # SQLAlchemy –º–æ–¥–µ–ª–∏ (10 —Ç–∞–±–ª–∏—Ü)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ session.py           # Async —Å–µ—Å—Å–∏—è –ë–î
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ integrations/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ iiko/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ client.py        # iiko Cloud API –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ schemas.py       # –°—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö iiko
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rkeeper/             # [Placeholder]
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sync/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ iiko_sync.py     # –°–µ—Ä–≤–∏—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ iiko
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tasks.py         # Celery –∑–∞–¥–∞—á–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ reports/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sales.py         # SalesReportService
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ menu.py          # MenuAnalysisService (ABC/XYZ/Go-List)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ export/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ excel.py         # ExcelExportService
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cache.py             # Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ analytics/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ motive.py        # Motive Marketing (6 —Ñ–∞–∫—Ç–æ—Ä–æ–≤)
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ pnl.py           # P&L Report Service
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ hr.py            # HR Analytics
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ basket.py        # Basket Analysis
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ telegram/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bot.py               # TelegramBot class + setup
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ commands.py      # /start, /sales, /forecast, etc.
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ callbacks.py     # Inline keyboard handlers
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ keyboards.py         # Inline keyboards
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ formatters.py        # Message formatters
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services.py          # TelegramUserService
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ notifications.py     # NotificationService
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tasks.py             # Celery tasks for notifications
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.py                  # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ alembic/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ env.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ versions/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ 001_initial_schema.py
‚îÇ   ‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ conftest.py              # Pytest —Ñ–∏–∫—Å—Ç—É—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test_auth.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ test_venues.py
‚îÇ   ‚îú‚îÄ‚îÄ alembic.ini
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ frontend/                         # Vue.js 3 Dashboard
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/                      # Axios API –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/               # UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout/               # AppHeader, AppSidebar
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ common/               # StatCard, DataTable, DateRangePicker
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ charts/               # ECharts –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stores/                   # Pinia stores
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ views/                    # Dashboard, Sales, Menu, Settings, Login
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ router/                   # Vue Router
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ types/                    # TypeScript —Ç–∏–ø—ã
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îú‚îÄ‚îÄ vite.config.ts
‚îÇ   ‚îî‚îÄ‚îÄ tailwind.config.js
‚îú‚îÄ‚îÄ telegram/                         # [Phase 6 - Bot + Mini App]
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ CLAUDE.md                         # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îî‚îÄ‚îÄ .gitignore
```

---

## 3. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ö–µ–º–∞ (10 —Ç–∞–±–ª–∏—Ü)

```
organizations (–º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç)
    ‚îî‚îÄ‚îÄ users (—Ä–æ–ª–∏: owner, admin, manager, analyst, viewer)
    ‚îî‚îÄ‚îÄ venues (–∑–∞–≤–µ–¥–µ–Ω–∏—è —Å POS –∫–æ–Ω—Ñ–∏–≥–æ–º)
            ‚îú‚îÄ‚îÄ categories (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –º–µ–Ω—é)
            ‚îú‚îÄ‚îÄ products (–ø–æ–∑–∏—Ü–∏–∏ –º–µ–Ω—é)
            ‚îú‚îÄ‚îÄ employees (—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏)
            ‚îú‚îÄ‚îÄ receipts (—á–µ–∫–∏)
            ‚îÇ       ‚îî‚îÄ‚îÄ receipt_items (–ø–æ–∑–∏—Ü–∏–∏ —á–µ–∫–∞)
            ‚îú‚îÄ‚îÄ daily_sales (–∞–≥—Ä–µ–≥–∞—Ç—ã –ø–æ –¥–Ω—è–º)
            ‚îî‚îÄ‚îÄ hourly_sales (–∞–≥—Ä–µ–≥–∞—Ç—ã –ø–æ —á–∞—Å–∞–º)
```

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- UUID –ø–µ—Ä–≤–∏—á–Ω—ã–µ –∫–ª—é—á–∏
- –ú—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (organization_id)
- JSONB –¥–ª—è –≥–∏–±–∫–∏—Ö –∫–æ–Ω—Ñ–∏–≥–æ–≤ (pos_config, settings)
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –¥–∞—Ç–∞–º
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è venue_id + external_id

---

## 4. API Endpoints

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è `/api/v1/auth`
| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| POST | `/register` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ + –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| POST | `/login` | –í—Ö–æ–¥ –ø–æ email/password |
| POST | `/telegram` | –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Telegram Mini App |
| POST | `/refresh` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ |
| GET | `/me` | –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å |

### –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ `/api/v1/organizations`
| –ú–µ—Ç–æ–¥ | Endpoint | –†–æ–ª—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|------|----------|
| GET | `/current` | any | –¢–µ–∫—É—â–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è |
| PATCH | `/current` | owner | –û–±–Ω–æ–≤–∏—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é |
| GET | `/users` | owner | –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| POST | `/users` | owner | –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| PATCH | `/users/{id}` | owner | –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| DELETE | `/users/{id}` | owner | –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |

### –ó–∞–≤–µ–¥–µ–Ω–∏—è `/api/v1/venues`
| –ú–µ—Ç–æ–¥ | Endpoint | –†–æ–ª—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|------|----------|
| GET | `` | any | –°–ø–∏—Å–æ–∫ –∑–∞–≤–µ–¥–µ–Ω–∏–π |
| POST | `` | admin | –°–æ–∑–¥–∞—Ç—å –∑–∞–≤–µ–¥–µ–Ω–∏–µ |
| GET | `/{id}` | any | –î–µ—Ç–∞–ª–∏ –∑–∞–≤–µ–¥–µ–Ω–∏—è |
| PATCH | `/{id}` | admin | –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≤–µ–¥–µ–Ω–∏–µ |
| DELETE | `/{id}` | admin | –£–¥–∞–ª–∏—Ç—å –∑–∞–≤–µ–¥–µ–Ω–∏–µ |
| POST | `/{id}/sync` | manager | –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é |
| GET | `/{id}/sync/status` | any | –°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ |

### –û—Ç—á—ë—Ç—ã –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º `/api/v1/reports/sales`
| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| GET | `/summary` | –°–≤–æ–¥–∫–∞ –ø—Ä–æ–¥–∞–∂ –∑–∞ –ø–µ—Ä–∏–æ–¥ |
| GET | `/daily` | –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ä–∞–∑–±–∏–≤–∫–∞ |
| GET | `/comparison` | –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–æ—à–ª—ã–º –ø–µ—Ä–∏–æ–¥–æ–º |
| GET | `/by-venue` | –†–∞–∑–±–∏–≤–∫–∞ –ø–æ –∑–∞–≤–µ–¥–µ–Ω–∏—è–º |
| GET | `/hourly` | –ü–æ—á–∞—Å–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ |
| GET | `/plan-fact` | –ü–ª–∞–Ω/—Ñ–∞–∫—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è |
| GET | `/top-days` | –¢–æ–ø –¥–Ω–µ–π –ø–æ –≤—ã—Ä—É—á–∫–µ |
| GET | `/weekday-analysis` | –ê–Ω–∞–ª–∏–∑ –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏ |

### –ê–Ω–∞–ª–∏–∑ –º–µ–Ω—é `/api/v1/reports/menu`
| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| GET | `/abc` | ABC-–∞–Ω–∞–ª–∏–∑ (–ø–æ –≤—ã—Ä—É—á–∫–µ/–ø—Ä–∏–±—ã–ª–∏/–∫–æ–ª–∏—á–µ—Å—Ç–≤—É) |
| GET | `/margin` | –ú–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç–æ–≤ |
| GET | `/go-list` | Go-List –º–∞—Ç—Ä–∏—Ü–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π |
| GET | `/top-sellers` | –¢–æ–ø –ø—Ä–æ–¥–∞–≤–∞–µ–º—ã—Ö –±–ª—é–¥ |
| GET | `/worst-sellers` | –ê—É—Ç—Å–∞–π–¥–µ—Ä—ã –º–µ–Ω—é |
| GET | `/categories` | –ê–Ω–∞–ª–∏–∑ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º |

### –≠–∫—Å–ø–æ—Ä—Ç `/api/v1/reports/export`
| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| GET | `/sales` | –≠–∫—Å–ø–æ—Ä—Ç –ø—Ä–æ–¥–∞–∂ –≤ Excel |
| GET | `/abc` | –≠–∫—Å–ø–æ—Ä—Ç ABC-–∞–Ω–∞–ª–∏–∑–∞ –≤ Excel |
| GET | `/go-list` | –≠–∫—Å–ø–æ—Ä—Ç Go-List –≤ Excel |
| GET | `/margin` | –≠–∫—Å–ø–æ—Ä—Ç –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –≤ Excel |

### –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ `/api/v1/analytics`
| –ì—Ä—É–ø–ø–∞ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|----------|
| Motive | `/motive/report` | –ü–æ–ª–Ω—ã–π –æ—Ç—á—ë—Ç 6 —Ñ–∞–∫—Ç–æ—Ä–æ–≤ |
| Motive | `/motive/weekdays` | –ê–Ω–∞–ª–∏–∑ –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏ |
| Motive | `/motive/seasonality` | –°–µ–∑–æ–Ω–Ω–æ—Å—Ç—å |
| P&L | `/pnl/report` | –ü–æ–ª–Ω—ã–π P&L –æ—Ç—á—ë—Ç |
| P&L | `/pnl/margin-trend` | –¢—Ä–µ–Ω–¥ –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ |
| HR | `/hr/report` | HR –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ |
| HR | `/hr/rankings` | –†–µ–π—Ç–∏–Ω–≥ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ |
| Basket | `/basket/report` | –ê–Ω–∞–ª–∏–∑ –∫–æ—Ä–∑–∏–Ω—ã |
| Basket | `/basket/product-pairs` | –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã |
| Basket | `/basket/cross-sell` | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–æ–ø—Ä–æ–¥–∞–∂ |

### Telegram `/api/v1/telegram`
| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| POST | `/webhook` | Telegram webhook handler |
| POST | `/webhook/setup` | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook URL |
| DELETE | `/webhook` | –£–¥–∞–ª–µ–Ω–∏–µ webhook |
| POST | `/link` | –ü—Ä–∏–≤—è–∑–∫–∞ Telegram –∞–∫–∫–∞—É–Ω—Ç–∞ |
| DELETE | `/link` | –û—Ç–≤—è–∑–∫–∞ Telegram –∞–∫–∫–∞—É–Ω—Ç–∞ |
| GET | `/notifications/settings` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π |
| PATCH | `/notifications/settings` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ |
| GET | `/bot/info` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ |

---

## 5. iiko –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Ç–æ–∫–µ–Ω–∞ (60 –º–∏–Ω TTL)
- –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –ø—Ä–æ–¥—É–∫—Ç—ã)
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- OLAP –æ—Ç—á—ë—Ç—ã –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º
- Retry –ª–æ–≥–∏–∫–∞ —Å exponential backoff

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è venue.pos_config
```json
{
  "organization_id": "uuid-from-iiko",
  "api_login": "your-api-login"
}
```

### Celery –∑–∞–¥–∞—á–∏
- `sync_venue_data` ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ–¥–Ω–æ–≥–æ –∑–∞–≤–µ–¥–µ–Ω–∏—è
- `full_sync_all_venues` ‚Äî –ø–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ 3:00)
- `incremental_sync_all_venues` ‚Äî –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è (–∫–∞–∂–¥—ã–µ 15 –º–∏–Ω)
- `aggregate_daily_sales` ‚Äî –∞–≥—Ä–µ–≥–∞—Ü–∏—è –¥–Ω–µ–≤–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂ (0:05)

---

## 6. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
cd mozg-analytics
docker compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ API
curl http://localhost:8000/health
# Swagger UI: http://localhost:8000/docs

# Frontend (–æ—Ç–¥–µ–ª—å–Ω–æ)
cd frontend
npm install
npm run dev
# Dashboard: http://localhost:3000
```

### –õ–æ–∫–∞–ª—å–Ω–æ
```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PostgreSQL –∏ Redis
brew install postgresql redis
brew services start postgresql redis

# 2. –°–æ–∑–¥–∞—Ç—å –ë–î
createdb mozg_analytics

# 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ
cd backend
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env

# 4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# 5. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# 6. –ó–∞–ø—É—Å—Ç–∏—Ç—å API
uvicorn app.main:app --reload --port 8000

# 7. –ó–∞–ø—É—Å—Ç–∏—Ç—å Celery (–æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª)
celery -A app.core.celery_app worker --loglevel=info
celery -A app.core.celery_app beat --loglevel=info
```

---

## 7. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ
DATABASE_URL=postgresql+asyncpg://user:pass@host:5432/db
REDIS_URL=redis://localhost:6379/0
SECRET_KEY=your-secret-key-min-32-chars

# Telegram (–¥–ª—è Mini App auth)
TELEGRAM_BOT_TOKEN=123456:ABC-xyz

# iiko (–¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏)
IIKO_API_LOGIN=your-api-login
```

---

## 8. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
cd backend
source venv/bin/activate

# –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –ë–î
createdb mozg_analytics_test

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
pytest -v

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest --cov=app --cov-report=html
```

### –¢–µ–∫—É—â–∏–µ —Ç–µ—Å—Ç—ã
- `test_auth.py` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ª–æ–≥–∏–Ω, /me
- `test_venues.py` ‚Äî CRUD –∑–∞–≤–µ–¥–µ–Ω–∏–π
- `test_reports.py` ‚Äî —Å–µ—Ä–≤–∏—Å—ã –æ—Ç—á—ë—Ç–æ–≤ (sales, menu)
- `test_analytics.py` ‚Äî –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (motive, pnl, hr, basket)
- `test_forecasting.py` ‚Äî –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ (revenue, demand, anomaly)
- `test_telegram.py` ‚Äî Telegram bot (formatters, keyboards, notifications)

---

## 9. –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### Phase 1: –§—É–Ω–¥–∞–º–µ–Ω—Ç ‚úÖ
- [x] –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- [x] Docker Compose (PostgreSQL, Redis, API, Celery)
- [x] SQLAlchemy –º–æ–¥–µ–ª–∏ —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
- [x] JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è + Telegram OAuth
- [x] RBAC (owner, admin, manager, analyst, viewer)
- [x] CRUD Organizations, Users, Venues
- [x] iiko Cloud API –∫–ª–∏–µ–Ω—Ç
- [x] –°–µ—Ä–≤–∏—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- [x] Celery –∑–∞–¥–∞—á–∏ (sync, aggregation)
- [x] –ë–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (CLAUDE.md)

### Phase 2: –ë–∞–∑–æ–≤—ã–µ –æ—Ç—á—ë—Ç—ã ‚úÖ
- [x] SalesReportService: summary, daily, hourly, comparison, by-venue, plan-fact
- [x] MenuAnalysisService: ABC-–∞–Ω–∞–ª–∏–∑, XYZ-–∞–Ω–∞–ª–∏–∑, –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- [x] Go-List –º–∞—Ç—Ä–∏—Ü–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π (Stars, Workhorses, Puzzles, Dogs)
- [x] Top/worst sellers, category analysis
- [x] Excel —ç–∫—Å–ø–æ—Ä—Ç (openpyxl) –¥–ª—è –≤—Å–µ—Ö –æ—Ç—á—ë—Ç–æ–≤
- [x] Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (CacheService)
- [x] API endpoints (20+ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤)
- [x] Unit —Ç–µ—Å—Ç—ã –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤ –æ—Ç—á—ë—Ç–æ–≤

---

## 10. –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### Phase 3: Web Dashboard ‚úÖ
- [x] Vue.js 3 + Vite + TypeScript –ø—Ä–æ–µ–∫—Ç
- [x] Tailwind CSS —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è
- [x] Pinia stores (auth, venues, filters)
- [x] Vue Router —Å auth guards
- [x] API –∫–ª–∏–µ–Ω—Ç —Å axios (token refresh)
- [x] ECharts –≥—Ä–∞—Ñ–∏–∫–∏ (Line, Bar, Pie, Heatmap)
- [x] –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: StatCard, DataTable, DateRangePicker, VenueSelector
- [x] Views: Dashboard, Sales, Menu, Settings, Login

### Phase 4: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ ‚úÖ
- [x] Motive Marketing (6 —Ñ–∞–∫—Ç–æ—Ä–æ–≤: weekday, seasonality, events, pricing)
- [x] P&L –æ—Ç—á—ë—Ç (revenue, COGS, gross profit, operating expenses, EBITDA)
- [x] HR-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (employee rankings, shift analysis, productivity)
- [x] Basket analysis (product pairs, cross-sell, category affinity)

### Phase 5: –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ ‚úÖ
- [x] Prophet –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∞ –≤—ã—Ä—É—á–∫–∏ (RevenueForecastService)
- [x] –ü—Ä–æ–≥–Ω–æ–∑ —Å–ø—Ä–æ—Å–∞ –Ω–∞ –±–ª—é–¥–∞ (DemandForecastService)
- [x] Anomaly detection (AnomalyDetectionService —Å z-score)

### Phase 6: Telegram Integration ‚úÖ
- [x] Telegram Bot —Å –∫–æ–º–∞–Ω–¥–∞–º–∏ (/start, /sales, /today, /week, /forecast, /alerts, /venues, /report, /settings, /link)
- [x] Inline keyboards –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- [x] NotificationService –¥–ª—è push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- [x] –£—Ç—Ä–µ–Ω–Ω–∏–π –æ—Ç—á—ë—Ç (9:00) –∏ –≤–µ—á–µ—Ä–Ω–∏–π –æ—Ç—á—ë—Ç (22:00)
- [x] –ê–ª–µ—Ä—Ç—ã –æ–± –∞–Ω–æ–º–∞–ª–∏—è—Ö
- [x] Celery tasks –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- [x] API endpoints –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
- [x] –ü—Ä–∏–≤—è–∑–∫–∞ Telegram –∞–∫–∫–∞—É–Ω—Ç–∞ —á–µ—Ä–µ–∑ –∫–æ–¥

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
- [ ] R-Keeper –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (structlog)
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Sentry, Prometheus)
- [ ] CI/CD pipeline
- [ ] Production Dockerfile (multi-stage)

---

## 11. –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (2026-02-02)
1. **Python 3.9 —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –ó–∞–º–µ–Ω—ë–Ω —Å–∏–Ω—Ç–∞–∫—Å–∏—Å `X | Y` –Ω–∞ `Union[X, Y]` –≤ type hints
2. **SQLAlchemy Enum**: –î–æ–±–∞–≤–ª–µ–Ω `values_callable` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å PostgreSQL enum (lowercase)
3. **httpx –≤–µ—Ä—Å–∏—è**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç –≤–µ—Ä—Å–∏–π —Å python-telegram-bot
4. **Alembic –º–∏–≥—Ä–∞—Ü–∏–∏**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π engine –≤–º–µ—Å—Ç–æ async –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π
5. **get_user_venue_ids**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤ deps.py

### –¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
1. **bcrypt –≤–µ—Ä—Å–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 4.0.1 –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å passlib
2. **Python 3.9**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å –Ω–∞ 3.9.6, –¥–ª—è 3.11+ –≤–æ–∑–º–æ–∂–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç–∏–ø–∞—Ö
3. **iiko OLAP**: –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è, –¥–ª—è production –Ω—É–∂–Ω–∞ –¥–µ—Ç–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ–∫–æ–≤
4. **R-Keeper**: –¢–æ–ª—å–∫–æ placeholder, —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

---

## 12. –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ —Ä–µ—Å—É—Ä—Å—ã

- **iiko API Docs**: https://api-ru.iiko.services/swagger/ui/index
- **FastAPI Docs**: https://fastapi.tiangolo.com/
- **SQLAlchemy 2.0**: https://docs.sqlalchemy.org/en/20/

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repo-url>
cd mozg-analytics

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ Docker
docker compose up -d

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API
open http://localhost:8000/docs

# 4. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ Swagger UI
# POST /api/v1/auth/register

# 5. –ß–∏—Ç–∞—Ç—å CLAUDE.md –¥–ª—è –¥–µ—Ç–∞–ª–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```

---

## 13. –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (Changelog)

### Commit e1e462a ‚Äî Phase 1: Foundation (2026-02-01)

**–§—É–Ω–¥–∞–º–µ–Ω—Ç BI-–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã ‚Äî 45 —Ñ–∞–π–ª–æ–≤, +4399 —Å—Ç—Ä–æ–∫**

#### Backend Core
| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `app/main.py` | FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å CORS, lifespan, /health |
| `app/core/config.py` | Pydantic Settings —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è |
| `app/core/security.py` | JWT —Ç–æ–∫–µ–Ω—ã (access/refresh), bcrypt –ø–∞—Ä–æ–ª–∏, Telegram OAuth HMAC |
| `app/core/celery_app.py` | Celery + Redis broker, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á (crontab) |

#### Database Layer
| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `app/db/base.py` | –ë–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã: UUIDMixin, TimestampMixin |
| `app/db/models.py` | 10 SQLAlchemy –º–æ–¥–µ–ª–µ–π —Å relationships |
| `app/db/session.py` | Async session factory (asyncpg) |
| `alembic/versions/001_initial_schema.py` | –ú–∏–≥—Ä–∞—Ü–∏—è: –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã + –∏–Ω–¥–µ–∫—Å—ã |

**–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö:**
```
Organization ‚Üí users[], venues[]
User         ‚Üí organization, role (Enum: owner/admin/manager/analyst/viewer)
Venue        ‚Üí organization, pos_type (iiko/rkeeper), pos_config (JSONB)
Category     ‚Üí venue, products[]
Product      ‚Üí venue, category, price, cost_price, is_active
Employee     ‚Üí venue, external_id, name, role
Receipt      ‚Üí venue, receipt_items[], payment_type, discount
ReceiptItem  ‚Üí receipt, product, quantity, price, discount
DailySales   ‚Üí venue, date, revenue, orders_count, avg_check
HourlySales  ‚Üí venue, date, hour, revenue, orders_count
```

#### API Endpoints
| –§–∞–π–ª | Endpoints | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----------|----------|
| `app/api/v1/auth.py` | 5 | register, login, telegram, refresh, me |
| `app/api/v1/organizations.py` | 6 | CRUD –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ + —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ |
| `app/api/v1/venues.py` | 7 | CRUD –∑–∞–≤–µ–¥–µ–Ω–∏–π + sync endpoints |
| `app/api/deps.py` | ‚Äî | get_current_user, require_roles, RBAC –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã |
| `app/api/v1/schemas.py` | ‚Äî | 25+ Pydantic —Å—Ö–µ–º (request/response) |

#### iiko Integration
| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `app/integrations/iiko/client.py` | Async HTTP –∫–ª–∏–µ–Ω—Ç —Å retry (tenacity) |
| `app/integrations/iiko/schemas.py` | Pydantic —Å—Ö–µ–º—ã –¥–ª—è iiko API |

**IikoClient –º–µ—Ç–æ–¥—ã:**
- `_ensure_token()` ‚Äî –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ (TTL 60 –º–∏–Ω)
- `get_organizations()` ‚Äî —Å–ø–∏—Å–æ–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
- `get_nomenclature()` ‚Äî –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –ø—Ä–æ–¥—É–∫—Ç—ã
- `get_employees()` ‚Äî —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏
- `get_olap_report()` ‚Äî –ø—Ä–æ–¥–∞–∂–∏ (OLAP)

#### Sync Service
| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `app/services/sync/iiko_sync.py` | IikoSyncService: full/incremental sync |
| `app/services/sync/tasks.py` | Celery tasks —Å async wrapper |

**Celery –∑–∞–¥–∞—á–∏:**
| –ó–∞–¥–∞—á–∞ | –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|------------|----------|
| `sync_venue_data` | manual | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ–¥–Ω–æ–≥–æ –∑–∞–≤–µ–¥–µ–Ω–∏—è |
| `full_sync_all_venues` | 3:00 daily | –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö |
| `incremental_sync_all_venues` | */15 min | –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è (–ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å) |
| `aggregate_daily_sales` | 0:05 daily | –ê–≥—Ä–µ–≥–∞—Ü–∏—è –≤ daily_sales |

#### Infrastructure
| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `docker-compose.yml` | PostgreSQL, Redis, API, Celery Worker, Celery Beat |
| `backend/Dockerfile` | Python 3.9-slim + uvicorn |
| `backend/requirements.txt` | 25 –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π |
| `backend/.env.example` | –®–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è |

#### Tests
| –§–∞–π–ª | –¢–µ—Å—Ç—ã |
|------|-------|
| `tests/conftest.py` | pytest fixtures: async db, test client, auth helpers |
| `tests/test_auth.py` | register, login, /me endpoints |
| `tests/test_venues.py` | CRUD venues, permissions |

---

### Commit fd075be ‚Äî Phase 2 & 3 (2026-02-01)

**–û—Ç—á—ë—Ç—ã + Vue.js Dashboard ‚Äî 51 —Ñ–∞–π–ª, +7113 —Å—Ç—Ä–æ–∫**

#### Phase 2: Reports Backend

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `app/services/reports/sales.py` | SalesReportService |
| `app/services/reports/menu.py` | MenuAnalysisService |
| `app/services/export/excel.py` | ExcelExportService |
| `app/services/cache.py` | CacheService (Redis) |
| `app/api/v1/reports.py` | 20+ API endpoints |

**SalesReportService –º–µ—Ç–æ–¥—ã:**
| –ú–µ—Ç–æ–¥ | –í–æ–∑–≤—Ä–∞—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|---------|----------|
| `get_summary()` | SalesSummary | –í—ã—Ä—É—á–∫–∞, —á–µ–∫–∏, —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫ –∑–∞ –ø–µ—Ä–∏–æ–¥ |
| `get_daily()` | list[DailySalesData] | –†–∞–∑–±–∏–≤–∫–∞ –ø–æ –¥–Ω—è–º |
| `get_comparison()` | SalesComparison | –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–æ—à–ª—ã–º –ø–µ—Ä–∏–æ–¥–æ–º (%, delta) |
| `get_by_venue()` | list[VenueSalesData] | –í—ã—Ä—É—á–∫–∞ –ø–æ –∑–∞–≤–µ–¥–µ–Ω–∏—è–º |
| `get_hourly()` | list[HourlySalesData] | –ü–æ—á–∞—Å–æ–≤–∞—è —Ä–∞–∑–±–∏–≤–∫–∞ |
| `get_plan_fact()` | PlanFactData | –ü–ª–∞–Ω/—Ñ–∞–∫—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è |
| `get_top_days()` | list[TopDayData] | –¢–æ–ø –¥–Ω–µ–π –ø–æ –≤—ã—Ä—É—á–∫–µ |
| `get_weekday_analysis()` | list[WeekdayData] | –°—Ä–µ–¥–Ω–∏–µ –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏ |

**MenuAnalysisService –º–µ—Ç–æ–¥—ã:**
| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `abc_analysis(by='revenue')` | ABC –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (A=80%, B=95%, C=–æ—Å—Ç–∞—Ç–æ–∫) |
| `xyz_analysis()` | XYZ –ø–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—É –≤–∞—Ä–∏–∞—Ü–∏–∏ (X<10%, Y<25%, Z>25%) |
| `margin_analysis()` | –ú–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å: (price-cost)/price * 100 |
| `go_list()` | –ú–∞—Ç—Ä–∏—Ü–∞: Stars/Workhorses/Puzzles/Dogs/Potential/Standard |
| `top_sellers(limit)` | –¢–æ–ø –ø—Ä–æ–¥–∞–∂ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É |
| `worst_sellers(limit)` | –ê—É—Ç—Å–∞–π–¥–µ—Ä—ã –º–µ–Ω—é |
| `category_analysis()` | –†–∞–∑–±–∏–≤–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º |

**Go-List –º–∞—Ç—Ä–∏—Ü–∞:**
```
                 High Margin    Low Margin
High Sales    ‚Üí    Stars         Workhorses
Low Sales     ‚Üí    Puzzles       Dogs
New Items     ‚Üí    Potential     Standard
```

**ExcelExportService:**
- –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è: —Ü–≤–µ—Ç–∞ –¥–ª—è ABC/Go-List, –≥—Ä–∞–Ω–∏—Ü—ã, auto-width –∫–æ–ª–æ–Ω–æ–∫
- –§–æ—Ä–º–∞—Ç—ã: export_sales(), export_abc(), export_go_list(), export_margin()

**CacheService:**
- Custom JSONEncoder –¥–ª—è Decimal, date, datetime, UUID
- `@cached(ttl, key_builder)` –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä
- –ú–µ—Ç–æ–¥—ã: get(), set(), delete(), invalidate_pattern()

#### Phase 3: Vue.js Frontend

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –§–∞–π–ª—ã |
|-----------|-------|
| Config | package.json, vite.config.ts, tsconfig.json, tailwind.config.js |
| API Client | src/api/client.ts, auth.ts, venues.ts, reports.ts |
| Stores | src/stores/auth.ts, venues.ts, filters.ts |
| Router | src/router/index.ts (auth guards) |
| Types | src/types/index.ts (TypeScript interfaces) |

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|
| `AppHeader.vue` | Navbar —Å user menu, venue selector |
| `AppSidebar.vue` | –ù–∞–≤–∏–≥–∞—Ü–∏—è: Dashboard, Sales, Menu, Settings |
| `StatCard.vue` | KPI –∫–∞—Ä—Ç–æ—á–∫–∞ —Å –∏–∫–æ–Ω–∫–æ–π, –∑–Ω–∞—á–µ–Ω–∏–µ–º, delta % |
| `DataTable.vue` | –¢–∞–±–ª–∏—Ü–∞ —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π, –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π |
| `DateRangePicker.vue` | –í—ã–±–æ—Ä –ø–µ—Ä–∏–æ–¥–∞ —Å presets (—Å–µ–≥–æ–¥–Ω—è, –Ω–µ–¥–µ–ª—è, –º–µ—Å—è—Ü) |
| `VenueSelector.vue` | Dropdown –≤—ã–±–æ—Ä–∞ –∑–∞–≤–µ–¥–µ–Ω–∏—è |
| `LineChart.vue` | ECharts –ª–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ |
| `BarChart.vue` | ECharts —Å—Ç–æ–ª–±—á–∞—Ç—ã–π –≥—Ä–∞—Ñ–∏–∫ |
| `PieChart.vue` | ECharts –∫—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ |
| `HeatmapChart.vue` | ECharts —Ç–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ (—á–∞—Å—ã √ó –¥–Ω–∏) |

**Views:**

| View | –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª |
|------|------------|
| `LoginView.vue` | Email/password —Ñ–æ—Ä–º–∞, remember me |
| `DashboardView.vue` | KPI cards, revenue chart, top products, hourly heatmap |
| `SalesView.vue` | Tabs: overview, daily, venues, hourly + Excel export |
| `MenuView.vue` | Tabs: ABC analysis, Go-List, margins, categories |
| `SettingsView.vue` | Profile, venue management, iiko integration |

**Axios –∫–ª–∏–µ–Ω—Ç:**
- Interceptor: auto-attach Bearer token
- Response interceptor: 401 ‚Üí refresh token ‚Üí retry request
- Base URL: `/api/v1` (Vite proxy –≤ dev)

**Pinia Stores:**
| Store | State | Actions |
|-------|-------|---------|
| auth | user, token, isAuthenticated | login, logout, refreshToken, init |
| venues | venues[], selectedVenue | fetchVenues, selectVenue |
| filters | dateRange, quickFilter | setDateRange, setQuickFilter |

---

### Commit 325ef7d ‚Äî Phase 4: Advanced Analytics (2026-02-02)

**–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ ‚Äî 10 —Ñ–∞–π–ª–æ–≤, +4128 —Å—Ç—Ä–æ–∫**

#### Motive Marketing Service (`app/services/analytics/motive.py`)
| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `analyze_weekdays()` | –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–¥–∞–∂ –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏ —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ |
| `analyze_seasonality()` | –ú–µ—Å—è—á–Ω–∞—è —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—å —Å YoY —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º |
| `analyze_events()` | –í–ª–∏—è–Ω–∏–µ –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤ –Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ |
| `analyze_pricing()` | –ê–Ω–∞–ª–∏–∑ –≤–ª–∏—è–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω + —ç–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—å |
| `get_full_report()` | –ü–æ–ª–Ω—ã–π –æ—Ç—á—ë—Ç —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ |

**6 —Ñ–∞–∫—Ç–æ—Ä–æ–≤ –≤–ª–∏—è–Ω–∏—è:**
- Weekday patterns (–∏–Ω–¥–µ–∫—Å—ã –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏)
- Seasonality (–º–µ—Å—è—á–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã)
- Events/Holidays (–ø—Ä–∞–∑–¥–Ω–∏–∫–∏ –†–§)
- Pricing (—ç–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—å —Å–ø—Ä–æ—Å–∞)
- Weather (placeholder)
- Marketing (placeholder)

#### P&L Report Service (`app/services/analytics/pnl.py`)
| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `calculate_revenue_breakdown()` | –†–∞–∑–±–∏–≤–∫–∞ –≤—ã—Ä—É—á–∫–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º |
| `calculate_cogs()` | Cost of Goods Sold –∏–∑ receipt_items |
| `calculate_summary()` | –ü–æ–ª–Ω—ã–π P&L summary |
| `get_daily_pnl()` | –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Ç—Ä–µ–Ω–¥ –º–∞—Ä–∂–∏ |
| `get_margin_trend()` | –ú–µ—Å—è—á–Ω—ã–π —Ç—Ä–µ–Ω–¥ –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ |

**P&L –º–µ—Ç—Ä–∏–∫–∏:**
```
Gross Revenue ‚Üí Discounts ‚Üí Net Revenue
                                ‚Üì
                              COGS
                                ‚Üì
                          Gross Profit
                                ‚Üì
                    Operating Expenses (Labor, Rent, Marketing)
                                ‚Üì
                             EBITDA
                                ‚Üì
                    Depreciation + Taxes
                                ‚Üì
                          Net Profit
```

#### HR Analytics Service (`app/services/analytics/hr.py`)
| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `get_employee_metrics()` | –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞–∂–¥–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ |
| `get_employee_comparisons()` | –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Å—Ä–µ–¥–Ω–∏–º |
| `analyze_shifts()` | –ê–Ω–∞–ª–∏–∑ –ø–æ —Å–º–µ–Ω–∞–º (—É—Ç—Ä–æ/–¥–µ–Ω—å/–≤–µ—á–µ—Ä) |
| `get_hourly_productivity()` | –ü–æ—á–∞—Å–æ–≤–∞—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å |
| `calculate_team_metrics()` | –ö–æ–º–∞–Ω–¥–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ |

**Performance Levels:** TOP (80%+), ABOVE_AVG (60-80%), AVERAGE (40-60%), BELOW_AVG (20-40%), LOW (<20%)

#### Basket Analysis Service (`app/services/analytics/basket.py`)
| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `calculate_product_pairs()` | –ß–∞—Å—Ç–æ –ø–æ–∫—É–ø–∞–µ–º—ã–µ –≤–º–µ—Å—Ç–µ (Apriori) |
| `generate_cross_sell_recommendations()` | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–æ–ø—Ä–æ–¥–∞–∂ |
| `calculate_category_affinity()` | –°–≤—è–∑—å –º–µ–∂–¥—É –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ |
| `calculate_basket_profile()` | –ü—Ä–æ—Ñ–∏–ª—å –∫–æ—Ä–∑–∏–Ω—ã |
| `analyze_time_patterns()` | –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏ |

**Association Rule Metrics:**
- **Support**: P(A ‚à© B) ‚Äî –¥–æ–ª—è —á–µ–∫–æ–≤ —Å –æ–±–æ–∏–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏
- **Confidence**: P(B|A) ‚Äî –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å B –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ A
- **Lift**: –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ —Å–ª—É—á–∞–π–Ω–æ–º—É ‚Äî >1 –æ–∑–Ω–∞—á–∞–µ—Ç —Å–≤—è–∑—å

#### API Endpoints (`app/api/v1/analytics.py`)
| –ì—Ä—É–ø–ø–∞ | Endpoints | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|-----------|----------|
| `/motive` | report, weekdays, seasonality | Motive Marketing |
| `/pnl` | report, margin-trend | P&L –æ—Ç—á—ë—Ç—ã |
| `/hr` | report, rankings | HR –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ |
| `/basket` | report, product-pairs, cross-sell | Basket analysis |

---

## 14. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### Backend
1. **Async everywhere**: SQLAlchemy 2.0 async, httpx async, Celery —Å async wrapper
2. **Multi-tenant**: organization_id –≤–æ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö, RBAC —á–µ—Ä–µ–∑ deps.py
3. **Aggregate tables**: daily_sales/hourly_sales –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –æ—Ç—á—ë—Ç–æ–≤
4. **JSONB configs**: pos_config –∏ settings –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏ –±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–π

### Frontend
1. **Composition API**: `<script setup>` –≤–æ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
2. **Pinia**: Reactive stores —Å persist (localStorage)
3. **ECharts**: vue-echarts wrapper –¥–ª—è —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤
4. **Tailwind**: Utility-first CSS —Å dark mode support

### Integration
1. **Token auto-refresh**: iiko (60 –º–∏–Ω TTL), JWT (configurable)
2. **Retry logic**: tenacity —Å exponential backoff
3. **Graceful errors**: IikoAPIError —Å status_code

---

### Commit (Phase 5) ‚Äî Forecasting (2026-02-02)

**–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Prophet ‚Äî 9 —Ñ–∞–π–ª–æ–≤, +2888 —Å—Ç—Ä–æ–∫**

#### RevenueForecastService (`app/services/forecasting/revenue.py`)
| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `forecast_revenue()` | Prophet –ø—Ä–æ–≥–Ω–æ–∑ —Å —É—á—ë—Ç–æ–º —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏ |
| `quick_forecast()` | –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ–≥–Ω–æ–∑ –¥–ª—è dashboard |
| `_prepare_holidays()` | –†–æ—Å—Å–∏–π—Å–∫–∏–µ –ø—Ä–∞–∑–¥–Ω–∏–∫–∏ –¥–ª—è Prophet |
| `_calculate_accuracy()` | MAPE, RMSE, MAE, R¬≤ –º–µ—Ç—Ä–∏–∫–∏ |

#### DemandForecastService (`app/services/forecasting/demand.py`)
| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `forecast_product_demand()` | –ü—Ä–æ–≥–Ω–æ–∑ —Å–ø—Ä–æ—Å–∞ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç |
| `forecast_all_products()` | –ú–∞—Å—Å–æ–≤—ã–π –ø—Ä–æ–≥–Ω–æ–∑ (top N) |
| `_calculate_trend()` | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–∞ (up/down/stable) |

#### AnomalyDetectionService (`app/services/forecasting/anomaly.py`)
| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `detect_daily_anomalies()` | Z-score anomalies |
| `detect_product_anomalies()` | –ê–Ω–æ–º–∞–ª–∏–∏ –≤ –ø—Ä–æ–¥–∞–∂–∞—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ |
| `generate_report()` | –ü–æ–ª–Ω—ã–π –æ—Ç—á—ë—Ç —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ |

**Z-score –ø–æ—Ä–æ–≥–∏:**
| Severity | Z-score |
|----------|---------|
| LOW | ‚â• 2œÉ |
| MEDIUM | ‚â• 3œÉ |
| HIGH | ‚â• 4œÉ |
| CRITICAL | ‚â• 5œÉ |

---

### Commit (Phase 6) ‚Äî Telegram Integration (2026-02-02)

**Telegram –±–æ—Ç –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ‚Äî 10 —Ñ–∞–π–ª–æ–≤, +1900 —Å—Ç—Ä–æ–∫**

#### Bot Commands (`app/telegram/handlers/commands.py`)
| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/start` | –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é |
| `/help` | –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º |
| `/sales` | –í—ã–±–æ—Ä –ø–µ—Ä–∏–æ–¥–∞ –¥–ª—è –æ—Ç—á—ë—Ç–∞ |
| `/today` | –ü—Ä–æ–¥–∞–∂–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è |
| `/week` | –ü—Ä–æ–¥–∞–∂–∏ –∑–∞ –Ω–µ–¥–µ–ª—é |
| `/month` | –ü—Ä–æ–¥–∞–∂–∏ –∑–∞ –º–µ—Å—è—Ü |
| `/forecast` | –ü—Ä–æ–≥–Ω–æ–∑ –≤—ã—Ä—É—á–∫–∏ |
| `/alerts` | –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∞–Ω–æ–º–∞–ª–∏–∏ |
| `/venues` | –°–ø–∏—Å–æ–∫ –∑–∞–≤–µ–¥–µ–Ω–∏–π |
| `/report` | –í—ã–±–æ—Ä —Ç–∏–ø–∞ –æ—Ç—á—ë—Ç–∞ |
| `/settings` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π |
| `/link` | –ü—Ä–∏–≤—è–∑–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ |

#### Inline Keyboards (`app/telegram/keyboards.py`)
| Keyboard | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| `get_main_menu_keyboard()` | –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é |
| `get_period_keyboard()` | –í—ã–±–æ—Ä –ø–µ—Ä–∏–æ–¥–∞ |
| `get_report_keyboard()` | –¢–∏–ø—ã –æ—Ç—á—ë—Ç–æ–≤ |
| `get_settings_keyboard()` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π |
| `get_venues_keyboard()` | –°–ø–∏—Å–æ–∫ –∑–∞–≤–µ–¥–µ–Ω–∏–π |

#### NotificationService (`app/telegram/notifications.py`)
| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `send_morning_report()` | –£—Ç—Ä–µ–Ω–Ω–∏–π –æ—Ç—á—ë—Ç (9:00) |
| `send_evening_report()` | –í–µ—á–µ—Ä–Ω–∏–π –æ—Ç—á—ë—Ç (22:00) |
| `send_anomaly_alert()` | –ê–ª–µ—Ä—Ç –æ–± –∞–Ω–æ–º–∞–ª–∏–∏ |
| `send_goal_achieved()` | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ü–µ–ª–∏ |
| `send_sync_error()` | –û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (admin only) |

#### Celery Tasks (`app/telegram/tasks.py`)
| Task | Schedule | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|----------|
| `send_morning_reports` | 9:00 daily | –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ —É—Ç—Ä–µ–Ω–Ω–∏—Ö –æ—Ç—á—ë—Ç–æ–≤ |
| `send_evening_reports` | 22:00 daily | –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ –≤–µ—á–µ—Ä–Ω–∏—Ö –æ—Ç—á—ë—Ç–æ–≤ |
| `check_and_send_anomalies` | */2 hours | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤ |

#### API Endpoints (`app/api/v1/telegram_webhook.py`)
| Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| `POST /webhook` | Telegram updates handler |
| `POST /webhook/setup` | –£—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook URL |
| `POST /link` | –ü—Ä–∏–≤—è–∑–∫–∞ –ø–æ –∫–æ–¥—É |
| `GET/PATCH /notifications/settings` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π |

#### Message Formatters (`app/telegram/formatters.py`)
| Formatter | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|
| `format_sales_summary()` | –°–≤–æ–¥–∫–∞ –ø—Ä–æ–¥–∞–∂ |
| `format_forecast_message()` | –ü—Ä–æ–≥–Ω–æ–∑ –≤—ã—Ä—É—á–∫–∏ |
| `format_anomaly_alert()` | –ê–ª–µ—Ä—Ç –æ–± –∞–Ω–æ–º–∞–ª–∏–∏ |
| `format_abc_report()` | ABC-–∞–Ω–∞–ª–∏–∑ |
| `format_morning_report()` | –£—Ç—Ä–µ–Ω–Ω–∏–π –æ—Ç—á—ë—Ç |
| `format_evening_report()` | –í–µ—á–µ—Ä–Ω–∏–π –∏—Ç–æ–≥–∏ –¥–Ω—è |

---

---

## 15. Production Deployment Checklist

### –ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

- [ ] –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–π `SECRET_KEY` (–º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å PostgreSQL —Å SSL
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Redis —Å –ø–∞—Ä–æ–ª–µ–º
- [ ] –ü–æ–ª—É—á–∏—Ç—å production TELEGRAM_BOT_TOKEN
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ–º–µ–Ω –∏ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
- [ ] –°–æ–∑–¥–∞—Ç—å Telegram webhook URL

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è production

```env
# Database
DATABASE_URL=postgresql+asyncpg://user:STRONG_PASSWORD@db-host:5432/mozg_production
DATABASE_POOL_SIZE=50
DATABASE_MAX_OVERFLOW=20

# Redis
REDIS_URL=redis://:REDIS_PASSWORD@redis-host:6379/0

# Security
SECRET_KEY=GENERATE_SECURE_KEY_MIN_32_CHARS
DEBUG=false

# Telegram
TELEGRAM_BOT_TOKEN=production-bot-token
TELEGRAM_WEBAPP_URL=https://your-domain.com/miniapp

# iiko
IIKO_API_LOGIN=production-api-login

# CORS
CORS_ORIGINS=["https://your-domain.com"]
```

### Docker production

```bash
# Build optimized image
docker build -t mozg-analytics:latest -f backend/Dockerfile.prod backend/

# Run with docker-compose
docker compose -f docker-compose.prod.yml up -d
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram Webhook

```bash
# –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è API
curl -X POST "https://api.telegram.org/bot<TOKEN>/setWebhook?url=https://your-domain.com/api/v1/telegram/webhook"
```

---

## 16. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –¥–∞–ª—å–Ω–µ–π—à–µ–º—É —Ä–∞–∑–≤–∏—Ç–∏—é

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
- [ ] –î–æ–±–∞–≤–∏—Ç—å structlog –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Sentry –¥–ª—è error tracking
- [ ] –î–æ–±–∞–≤–∏—Ç—å health checks –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Prometheus + Grafana –º–µ—Ç—Ä–∏–∫–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- [ ] R-Keeper –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ iiko)
- [ ] Poster POS –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF (reportlab)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å 1–° –¥–ª—è P&L

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] Horizontal scaling Celery workers
- [ ] Read replicas –¥–ª—è PostgreSQL
- [ ] CDN –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏ frontend
- [ ] Rate limiting –¥–ª—è API

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4: UX —É–ª—É—á—à–µ–Ω–∏—è
- [ ] Telegram Mini App –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- [ ] Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- [ ] –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (React Native)
- [ ] –ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤ Telegram –±–æ—Ç–µ

---

## 17. –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è

### Backend (–≤ –ø–æ—Ä—è–¥–∫–µ –≤–∞–∂–Ω–æ—Å—Ç–∏)

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| `app/main.py` | –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastAPI |
| `app/core/config.py` | –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |
| `app/db/models.py` | –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö |
| `app/api/v1/router.py` | –í—Å–µ API routes |
| `app/services/reports/sales.py` | –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø—Ä–æ–¥–∞–∂ |
| `app/services/forecasting/revenue.py` | Prophet –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ |
| `app/telegram/bot.py` | Telegram –±–æ—Ç |

### Frontend

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| `src/main.ts` | –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ Vue |
| `src/stores/auth.ts` | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
| `src/api/client.ts` | HTTP –∫–ª–∏–µ–Ω—Ç |
| `src/views/DashboardView.vue` | –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ |

---

## 18. FAQ –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

**Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π API endpoint?**
A: 1) –°–æ–∑–¥–∞—Ç—å router –≤ `app/api/v1/`, 2) –î–æ–±–∞–≤–∏—Ç—å —Å—Ö–µ–º—ã –≤ `schemas.py`, 3) –ü–æ–¥–∫–ª—é—á–∏—Ç—å –≤ `router.py`

**Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π Telegram –∫–æ–º–∞–Ω–¥—É?**
A: 1) –î–æ–±–∞–≤–∏—Ç—å handler –≤ `app/telegram/handlers/commands.py`, 2) –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `app/telegram/bot.py`

**Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é Celery –∑–∞–¥–∞—á—É?**
A: 1) –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Å `@celery_app.task`, 2) –î–æ–±–∞–≤–∏—Ç—å –≤ `beat_schedule` –≤ `celery_app.py`

**Q: –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –ª–æ–∫–∞–ª—å–Ω–æ?**
A: `cd backend && pytest -v --tb=short`

**Q: –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏?**
A: `cd backend && alembic upgrade head`

**Q: –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é?**
A: `cd backend && alembic revision --autogenerate -m "description"`

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤:
1. –ß–∏—Ç–∞–π—Ç–µ `CLAUDE.md` ‚Äî —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
2. Swagger UI: `http://localhost:8000/docs`
3. –¢–µ—Å—Ç—ã ‚Äî –ª—É—á—à–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è

---

## üîó –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

**GitHub**: https://github.com/foodcost-uzb/mozg-analytics

```bash
git clone https://github.com/foodcost-uzb/mozg-analytics.git
cd mozg-analytics
```

---

*–î–æ–∫—É–º–µ–Ω—Ç –æ–±–Ω–æ–≤–ª—ë–Ω: 2026-02-02. –í—Å–µ 6 —Ñ–∞–∑ –∑–∞–≤–µ—Ä—à–µ–Ω—ã. –ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ production.*
